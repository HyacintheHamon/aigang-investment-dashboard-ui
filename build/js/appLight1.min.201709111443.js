function chunkWalletAddress(e){var t,n,a=[];for(a.push(e.substr(0,2)),t=2,n=e.length;t<n;t+=4)a.push(e.substr(t,4));return a}function errorHappened(e){if(null!=e)return console.log(e),alert("There was an error fetching contract."),!0}function fillform(e,t){if(!errorHappened(e)){if(0==t.length)return void App.displayNoWalletModal();this.accounts=t,this.account=accounts[0],web3.eth.defaultAccount=accounts[0],App.fillInvestorPart(),App.fillInvestorInvestment(),App.fillTableLine1(),App.fillTableLine2()}}const Web3=require("web3"),contractAddress_v1="0x554ab5f5fe7006223c2dd321b420e9a05d48ec93",contractAddress_v2="0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6",etherscanAddress="https://ropsten.etherscan.io/";var accounts,account,policyContract_v1,policyContract_v2;window.App={start:function(){var e=JSON.parse('[ { "constant": false, "inputs": [ { "name": "policyOwner", "type": "address" } ], "name": "confirmPolicy", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInsurers", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "itemId", "type": "string" }, { "name": "deviceBrand", "type": "string" }, { "name": "deviceYear", "type": "string" }, { "name": "wearLevel", "type": "string" }, { "name": "region", "type": "string" } ], "name": "insure", "outputs": [ { "name": "insured", "type": "bool" } ], "payable": true, "type": "function" }, { "constant": false, "inputs": [ { "name": "wearLevel", "type": "uint256" } ], "name": "claim", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "getPolicyEndDateTimestamp", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInvestedAmount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalClaimsPaid", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "investors", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInvestorsCount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "getPolicyNextPayment", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "basePremium", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "deviceBrand", "type": "string" }, { "name": "deviceYear", "type": "string" }, { "name": "wearLevel", "type": "string" }, { "name": "region", "type": "string" } ], "name": "policyPrice", "outputs": [ { "name": "price", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "maxPayout", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "claimed", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [], "name": "invest", "outputs": [ { "name": "success", "type": "bool" } ], "payable": true, "type": "function" }, { "inputs": [], "payable": true, "type": "constructor" }, { "payable": true, "type": "fallback" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "deviceName", "type": "string" }, { "indexed": false, "name": "insurancePrice", "type": "uint256" } ], "name": "Insured", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "payout", "type": "uint256" } ], "name": "Claimed", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Invested", "type": "event" } ]'),t=web3.eth.contract(e);policyContract_v1=t.at(contractAddress_v1);var n=JSON.parse('[{"constant":true,"inputs":[],"name":"isInvestmentPeriodEnded","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"policyOwner","type":"address"}],"name":"confirmPolicy","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInsurers","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"itemId","type":"string"},{"name":"deviceBrand","type":"string"},{"name":"deviceYear","type":"string"},{"name":"wearLevel","type":"string"},{"name":"region","type":"string"}],"name":"insure","outputs":[{"name":"insured","type":"bool"}],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"wearLevel","type":"uint256"}],"name":"claim","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPolicyEndDateTimestamp","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInvestedAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"writtenPremiumAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"calculateDividends","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalClaimsPaid","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"investors","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInvestorsCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"transferDividends","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"payedDividendsAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"policiesLimit","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"lastPolicyDate","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPolicyNextPayment","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"basePremium","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"deviceBrand","type":"string"},{"name":"deviceYear","type":"string"},{"name":"wearLevel","type":"string"},{"name":"region","type":"string"}],"name":"policyPrice","outputs":[{"name":"price","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkAvailableDividends","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getdiMyDividendsAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"investmentsDeadlineTimeStamp","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxPayout","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"claimed","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"invest","outputs":[{"name":"success","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"investmentsLimit","outputs":[{"name":"","type":"uint128"}],"payable":false,"type":"function"},{"inputs":[],"payable":true,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"deviceName","type":"string"},{"indexed":false,"name":"insurancePrice","type":"uint256"}],"name":"Insured","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"payout","type":"uint256"}],"name":"Claimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"date","type":"uint256"},{"indexed":false,"name":"payout","type":"uint256"}],"name":"DividendsPayed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"value","type":"uint256"}],"name":"Invested","type":"event"}]'),a=web3.eth.contract(n);policyContract_v2=a.at(contractAddress_v2),web3.eth.getAccounts(fillform)},fillInvestorPart:function(){var e=chunkWalletAddress(account).join(" ");$("#wallet_address").html(e),web3.eth.getBalance(account,function(e,t){if(e)console.log(e),alert("There was an error fetching contract.");else{var n=web3.fromWei(t.toNumber(),"ether");$("#wallet_balance").html(n)}})},fillInvestorInvestment:function(){policyContract_v1.investors(account,function(e,t){if(errorHappened(e))return void alert(e);var n=web3.fromWei(t,"ether");policyContract_v2.investors(account,function(e,t){if(errorHappened(e))return void alert(e);var a=web3.fromWei(t,"ether"),s=n.add(a);$("#invested").html(s.toString()),0==s?$("#projectedProfit").html("20% of an investment"):$("#projectedProfit").html("16.5 %")})}),policyContract_v2.getdiMyDividendsAmount(function(e,t){if(!errorHappened(e)){var n=web3.fromWei(t,"ether");$("#revenueReceived").html(n.toString())}})},fillTableLine1:function(){$("#predictedProfit_table").html("20%")},fillTableLine2:function(){var e=this;$("#predictedProfit2_table").html("13%"),policyContract_v2.checkAvailableDividends.call({from:e.account},function(e,t){if(!errorHappened(e)&&t>0){var n=web3.fromWei(t,"ether");document.getElementById("dividendsDiv").innerHTML=" <div><small>You have: "+n.toString()+'</small><button data-toggle="modal" data-click="get-dividends-modal" class="btn btn-sm btn-primary" type="button">GET PROFIT</button> </div>'}})},investMoney:function(){var e=$("#enterValue").val(),t=web3.toWei(e,"ether"),n=web3.toBigNumber(t);policyContract_v2.invest({gas:3e5,from:account,value:n},function(e,t){if(null!=e)return console.log(e),$("#modalTitle").html("Investment was canceled."),$("#modalText").html("Transaction is canceled."),void $("#generalModal").modal("show");App.refreshPage(t);var n=etherscanAddress+"tx/"+t;$("#modalTitle").html("Investment Successful"),$("#modalText").html('Great success! Transaction has been sent. Ethers should apear in the wallet any moment (it might take up to a few minutes). You can check progress here: <br /><br /><a class="btn-link" href="'+n+'" target="_blank">'+n+"</a><br /><br />Ethers should appear in the wallet at any moment. Please refresh the page after few minutes!"),$("#generalModal").modal("show")})},getDividends:function(){policyContract_v2.transferDividends(function(e,t){if(null!=e)return console.log(e),$("#modalTitle").html("Error happened."),$("#modalText").html("Try again later."),void $("#generalModal").modal("show");App.refreshPage(t),document.getElementById("dividendsDiv").innerHTML="Not available";var n=etherscanAddress+"tx/"+t;$("#modalTitle").html("Claim transfer Successful"),$("#modalText").html('Great success! Transaction has been sent. Ethers should apear in the wallet any moment (it might take up to a few minutes). You can check progress here: <br /><br /><a class="btn-link" href="'+n+'" target="_blank">'+n+"</a><br /><br />Ethers should appear in the wallet at any moment. Please refresh the page after few minutes!"),$("#generalModal").modal("show")})},displayNoWalletModal:function(){$("#modalTitle").html("Only a few steps left to start investing!"),$("#modalText").html('To access our investment dashboard, you need to have <b>Ethereum Client</b> in place with Ropsten Testnet selected. (Metamask, Parity, Ethereum Mist browser or any other client that supports Web3). <br/><br/>For the best experience use Metamask. <div id="learnMore"><u>Learn how</u></div>      <ul id="instructionsList" style="display:none;"><li>Metamask download instructions can be found <a href="https://metamask.io" target="_blank"><u>here</u></a></li>      <li>Select “Ropsten Testnet” and create a new wallet.</li>      <li>Refresh the page.</li>      <li>To <b>invest</b>, you need <b>testnet Ethers</b>. Metamask gives you them by default, so you are ready to invest into Insurance.</li></ul><br/>      If you have any questions, please join our <a href="http://slack.aigang.network" target="_blank"> <u><b>Slack</b></u></a>      <br/><br/>      <b>No time for this?</b> Watch our short DEMO video by clicking <a href="https://www.youtube.com/watch?v=Hz-uL1fk49A&" target="_blank"><u>here</u></a>.        <script>$("#learnMore").click(function () {$("#instructionsList").toggle("1000ms");});<\/script>'),$("#generalModal").modal("show")},refreshPage:function(e){var t=e,n=web3.eth.filter("latest");n.watch(function(e,a){e||web3.eth.getBlockNumber(function(e,a){e||web3.eth.getBlock(a-4,function(e,a){!e&&a.transactions.length>0&&web3.eth.getTransaction(t,function(e,t){e||t&&t.from==account&&(n.stopWatching(),location.reload())})})})})}},window.addEventListener("load",function(){"undefined"!=typeof web3?(window.web3=new Web3(web3.currentProvider),web3.version.getNetwork(function(e,t){"3"==t?App.start():(console.log(e),App.displayNoWalletModal())})):App.displayNoWalletModal()});