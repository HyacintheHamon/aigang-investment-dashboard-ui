function chunkWalletAddress(t){var e,n,a=[];for(a.push(t.substr(0,2)),e=2,n=t.length;e<n;e+=4)a.push(t.substr(e,4));return a}function errorHappened(t){if(null!=t)return console.log(t),alert("There was an error fetching contract."),!0}function fillform(t,e){if(!errorHappened(t)){if(0==e.length)return void App.displayNoWalletModal();this.accounts=e,this.account=accounts[0],web3.eth.defaultAccount=accounts[0],App.fillInvestorPart(),App.fillInvestorInvestment(),App.fillInvestmentsHeader(),App.fillTableLine1(),App.fillTableLine2()}}const Web3=require("web3"),contractAddress_v1="0x554ab5f5fe7006223c2dd321b420e9a05d48ec93",contractAddress_v2="0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6",etherscanAddress="https://ropsten.etherscan.io/";var accounts,account,policyContract_v1,policyContract_v2;window.App={start:function(){var t=JSON.parse('[ { "constant": false, "inputs": [ { "name": "policyOwner", "type": "address" } ], "name": "confirmPolicy", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInsurers", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "itemId", "type": "string" }, { "name": "deviceBrand", "type": "string" }, { "name": "deviceYear", "type": "string" }, { "name": "wearLevel", "type": "string" }, { "name": "region", "type": "string" } ], "name": "insure", "outputs": [ { "name": "insured", "type": "bool" } ], "payable": true, "type": "function" }, { "constant": false, "inputs": [ { "name": "wearLevel", "type": "uint256" } ], "name": "claim", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "getPolicyEndDateTimestamp", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInvestedAmount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalClaimsPaid", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "investors", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalInvestorsCount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "getPolicyNextPayment", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "basePremium", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "deviceBrand", "type": "string" }, { "name": "deviceYear", "type": "string" }, { "name": "wearLevel", "type": "string" }, { "name": "region", "type": "string" } ], "name": "policyPrice", "outputs": [ { "name": "price", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "maxPayout", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "claimed", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [], "name": "invest", "outputs": [ { "name": "success", "type": "bool" } ], "payable": true, "type": "function" }, { "inputs": [], "payable": true, "type": "constructor" }, { "payable": true, "type": "fallback" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "deviceName", "type": "string" }, { "indexed": false, "name": "insurancePrice", "type": "uint256" } ], "name": "Insured", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "payout", "type": "uint256" } ], "name": "Claimed", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Invested", "type": "event" } ]'),e=web3.eth.contract(t);policyContract_v1=e.at(contractAddress_v1);var n=JSON.parse('[{"constant":true,"inputs":[],"name":"isInvestmentPeriodEnded","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"policyOwner","type":"address"}],"name":"confirmPolicy","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInsurers","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"itemId","type":"string"},{"name":"deviceBrand","type":"string"},{"name":"deviceYear","type":"string"},{"name":"wearLevel","type":"string"},{"name":"region","type":"string"}],"name":"insure","outputs":[{"name":"insured","type":"bool"}],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"wearLevel","type":"uint256"}],"name":"claim","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPolicyEndDateTimestamp","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInvestedAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"writtenPremiumAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"calculateDividends","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalClaimsPaid","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"investors","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalInvestorsCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"transferDividends","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"payedDividendsAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"policiesLimit","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"lastPolicyDate","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPolicyNextPayment","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"basePremium","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"deviceBrand","type":"string"},{"name":"deviceYear","type":"string"},{"name":"wearLevel","type":"string"},{"name":"region","type":"string"}],"name":"policyPrice","outputs":[{"name":"price","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkAvailableDividends","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getdiMyDividendsAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"investmentsDeadlineTimeStamp","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"maxPayout","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"claimed","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"invest","outputs":[{"name":"success","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"investmentsLimit","outputs":[{"name":"","type":"uint128"}],"payable":false,"type":"function"},{"inputs":[],"payable":true,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"deviceName","type":"string"},{"indexed":false,"name":"insurancePrice","type":"uint256"}],"name":"Insured","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"payout","type":"uint256"}],"name":"Claimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"date","type":"uint256"},{"indexed":false,"name":"payout","type":"uint256"}],"name":"DividendsPayed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"value","type":"uint256"}],"name":"Invested","type":"event"}]'),a=web3.eth.contract(n);policyContract_v2=a.at(contractAddress_v2),web3.eth.getAccounts(fillform)},fillInvestorPart:function(){var t=chunkWalletAddress(account).join(" ");$("#wallet_address").html(t),web3.eth.getBalance(account,function(t,e){if(t)console.log(t),alert("There was an error fetching contract.");else{var n=web3.fromWei(e.toNumber(),"ether");$("#wallet_balance").html(n)}})},fillInvestorInvestment:function(){policyContract_v1.investors(account,function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e,"ether");policyContract_v2.investors(account,function(t,e){if(!errorHappened(t)){var a=web3.fromWei(e,"ether"),o=n.add(a);$("#invested").html(o.toString()),0==o?$("#projectedProfit").html("20% of an investment"):$("#projectedProfit").html("16.5 %")}})}}),policyContract_v2.getdiMyDividendsAmount(function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e,"ether");$("#revenueReceived").html(n.toString())}})},fillInvestmentsHeader:function(){var t=this;policyContract_v1.totalInsurers.call(function(t,e){errorHappened(t)||policyContract_v2.totalInsurers.call(function(t,n){errorHappened(t)||$("#totalInsurers").html(e.add(n).toString())})}),policyContract_v1.totalClaimsPaid.call(function(t,e){errorHappened(t)||policyContract_v2.totalClaimsPaid.call(function(t,n){if(!errorHappened(t)){var a=e.add(n),o=web3.fromWei(a.toString(),"ether");$("#totalClaimsPaid").html(o.toString())}})});var e=0;policyContract_v2.totalInvestorsCount.call(t.account,function(t,n){errorHappened(t)||(e=n.add(e),$("#totalInvestorsCount").html(e.toString()))}),policyContract_v1.totalInvestorsCount.call(t.account,function(t,n){errorHappened(t)||(e=n.add(e),$("#totalInvestorsCount").html(e.toString()))});var n=0;policyContract_v1.totalInvestedAmount.call(t.account,function(t,e){errorHappened(t)||(n=web3.fromWei(e,"ether").add(n),$("#totalInvestedAmount").html(n.toString()))}),policyContract_v2.totalInvestedAmount.call(t.account,function(t,e){errorHappened(t)||(n=web3.fromWei(e,"ether").add(n),$("#totalInvestedAmount").html(n.toString()))}),web3.eth.getBalance(contractAddress_v1,function(t,e){errorHappened(t)||web3.eth.getBalance(contractAddress_v2,function(t,n){if(!errorHappened(t)){var a=web3.fromWei(e.add(n),"ether");$("#totalContractBalance").html((1*a).toFixed(4).toString())}})})},fillTableLine1:function(){var t=this;policyContract_v1.totalInsurers.call(function(t,e){errorHappened(t)||$("#totalInsurers_table").html(e.toString())}),policyContract_v1.totalClaimsPaid.call(function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e.toString(),"ether");$("#totalClaimsPaid_table").html(n.toString())}}),policyContract_v1.totalInvestedAmount.call(t.account,function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e,"ether");$("#totalInvestedAmount_table").html(n.toString()),$("#predictedProfit_table").html("20%")}}),policyContract_v1.totalInvestorsCount.call(t.account,function(t,e){errorHappened(t)||$("#totalInvestorsCount_table").html(e.toString())})},fillTableLine2:function(){var t=this;policyContract_v2.totalInsurers.call(function(t,e){errorHappened(t)||$("#totalInsurers2_table").html(e.toString())}),policyContract_v2.totalClaimsPaid.call(function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e.toString(),"ether");$("#totalClaimsPaid2_table").html(n.toString())}}),policyContract_v2.totalInvestedAmount.call(t.account,function(t,e){if(!errorHappened(t)){var n=web3.fromWei(e,"ether");$("#totalInvestedAmount2_table").html(n.toString()),$("#predictedProfit2_table").html("13%")}}),policyContract_v2.totalInvestorsCount.call(t.account,function(t,e){errorHappened(t)||$("#totalInvestorsCount2_table").html(e.toString())}),policyContract_v2.checkAvailableDividends.call({from:t.account},function(t,e){if(!errorHappened(t)&&e>0){var n=web3.fromWei(e,"ether");document.getElementById("dividendsDiv").innerHTML=" <div><small>You have: "+n.toString()+'</small><button data-toggle="modal" data-click="get-dividends-modal" class="btn btn-sm btn-primary" type="button">GET PROFIT</button> </div>'}})},investMoney:function(){var t=$("#enterValue").val(),e=web3.toWei(t,"ether"),n=web3.toBigNumber(e);policyContract_v2.invest(e,{gas:3e5,from:account,value:n},function(t,e){if(null!=t)return console.log(t),$("#modalTitle").html("Investment was canceled."),$("#modalText").html("Transaction is canceled."),void $("#generalModal").modal("show");App.refreshPage(e);var n=etherscanAddress+"tx/"+e;$("#modalTitle").html("Investment Successful"),$("#modalText").html('Great success! Transaction has been sent. Ethers should apear in the wallet any moment (it might take up to a few minutes). You can check progress here: <br /><br /><a class="btn-link" href="'+n+'" target="_blank">'+n+"</a><br /><br />Ethers should appear in the wallet at any moment."),$("#generalModal").modal("show")})},getDividends:function(){policyContract_v2.transferDividends(function(t,e){if(null!=t)return console.log(t),$("#modalTitle").html("Error happened."),$("#modalText").html("Try again later."),void $("#generalModal").modal("show");App.refreshPage(e),document.getElementById("dividendsDiv").innerHTML="Not available";var n=etherscanAddress+"tx/"+e;$("#modalTitle").html("Claim transfer Successful"),$("#modalText").html('Great success! Transaction has been sent. Ethers should apear in the wallet any moment (it might take up to a few minutes). You can check progress here: <br /><br /><a class="btn-link" href="'+n+'" target="_blank">'+n+"</a><br /><br />Ethers should appear in the wallet at any moment."),$("#generalModal").modal("show")})},displayNoWalletModal:function(){$("#modalTitle").html("This application works only in Ropsten Test Network"),$("#modalText").html("Make sure your Ethereum client(MetaMask or Mist browser) is configured correctly and switched to Ropsten test network."),$("#generalModal").modal("show")},refreshPage:function(t){var e=t,n=web3.eth.filter("latest");n.watch(function(t,a){t||web3.eth.getBlockNumber(function(t,a){t||web3.eth.getBlock(a-4,function(t,a){!t&&a.transactions.length>0&&web3.eth.getTransaction(e,function(t,e){t||e&&e.from==account&&(n.stopWatching(),location.reload())})})})})}},window.addEventListener("load",function(){"undefined"!=typeof web3?(window.web3=new Web3(web3.currentProvider),web3.version.getNetwork(function(t,e){"3"==e?App.start():(console.log(t),App.displayNoWalletModal())})):App.displayNoWalletModal()});